---
description: "Enhanced Comprehensive React Architecture Rules (2024)"
globs: 
alwaysApply: true
---

# ğŸ—ï¸ COMPREHENSIVE REACT ARCHITECTURE (2024)

## ğŸ“ MANDATORY FOLDER STRUCTURE

### Root Structure:
```
src/
â”œâ”€â”€ app/                         # Global application setup
â”‚   â”œâ”€â”€ App.tsx                  # Root component
â”‚   â”œâ”€â”€ providers/               # Global providers
â”‚   â”‚   â”œâ”€â”€ QueryProvider.tsx    # React Query setup
â”‚   â”‚   â”œâ”€â”€ ThemeProvider.tsx    # Theme configuration
â”‚   â”‚   â””â”€â”€ AuthProvider.tsx     # Authentication
â”‚   â”‚   â””â”€â”€ I18nProvider.tsx    # I18nProvider
â”‚   â”œâ”€â”€ stores/                  # Global Zustand stores
â”‚   â”‚   â”œâ”€â”€ authStore.ts         # Authentication state
â”‚   â”‚   â””â”€â”€ uiStore.ts           # Global UI state
â”‚   â””â”€â”€ router/                  # Global routing
â”‚       â”œâ”€â”€ AppRouter.tsx        # Main router with lazy loading
â”‚       â””â”€â”€ ProtectedRoute.tsx   # Route guards
â”œâ”€â”€ locales/                     # i18n translations
â”‚   â”œâ”€â”€ en/
â”‚   â”‚   â””â”€â”€ translation.json
â”‚   â”œâ”€â”€ vi/
â”‚   â”‚   â””â”€â”€ translation.json
â”‚   â””â”€â”€ i18n.ts                  # i18next configuration
â”œâ”€â”€ shared/                      # Shared/reusable logic
â”‚   â”œâ”€â”€ components/              # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ ui/                  # Common components & custom base elements
â”‚   â”‚   â”œâ”€â”€ shadcn/                  # Atomic shadcn components
â”‚   â”‚   â”œâ”€â”€ forms/               # Form components
â”‚   â”‚   â””â”€â”€ layout/              # Layout components
â”‚   â”œâ”€â”€ hooks/                   # Global custom hooks
â”‚   â”œâ”€â”€ utils/                   # Utility functions
â”‚   â”œâ”€â”€ types/                   # Global TypeScript types
â”‚   â”œâ”€â”€ lib/                     # Third-party configurations
â”‚   â”‚   â”œâ”€â”€ apiInstance.ts               # Axios instance
â”‚   â”‚   â”œâ”€â”€ react-query.ts       # React Query config
â”‚   â”‚   â””â”€â”€ zod-schemas.ts       # Shared validation schemas
â”‚   â”œâ”€â”€ config/                  # App configuration
â”‚   â”œâ”€â”€ constants/               # Application constants
â”‚   â””â”€â”€ assets/                  # Static assets
â”‚   â”œâ”€â”€ SharedRoutes.tsx     # shared routes aggregator
â”œâ”€â”€ public/                      # Public-facing features
â”‚   â”œâ”€â”€ PublicRoutes.tsx     # Public routes aggregator
â”‚   â”œâ”€â”€ features/                # Feature modules
â”‚   â”‚   â”œâ”€â”€ home/                # Example feature
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # âœ… MANDATORY export hub
â”‚   â”‚   â”‚   â”œâ”€â”€ router.tsx       # âœ… MANDATORY feature routes
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/           # Page components
â”‚   â”‚   â”‚   â”œâ”€â”€ components/      # Feature components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FeatureCard.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ FeatureCard.test.tsx  # âœ… Test files
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/           # React Query wrappers
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # API calls
â”‚   â”‚   â”‚   â”œâ”€â”€ types/           # TypeScript interfaces
â”‚   â”‚   â”‚   â””â”€â”€ utils/           # Feature utilities
â”‚   â”‚   â””â”€â”€ [other-features]/
â”‚   â”œâ”€â”€ layouts/                 # Public layouts
â”‚   â””â”€â”€ assets/                  # Public-specific assets (NOT manual CSS)
â”œâ”€â”€ admin/                       # Admin-only features
â”‚   â””â”€â”€ assets/                  # Admin-specific assets (NOT manual CSS)
â”‚   â”œâ”€â”€ features/                # Admin feature modules
â”‚   â”‚   â”œâ”€â”€ user/                # Example feature
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # âœ… MANDATORY export hub
â”‚   â”‚   â”‚   â”œâ”€â”€ router.tsx       # âœ… MANDATORY feature routes
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/           # Page components
â”‚   â”‚   â”‚   â”œâ”€â”€ components/      # Feature components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FeatureCard.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ FeatureCard.test.tsx  # âœ… Test files
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/           # React Query wrappers
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # API calls
â”‚   â”‚   â”‚   â”œâ”€â”€ types/           # TypeScript interfaces
â”‚   â”‚   â”‚   â””â”€â”€ utils/           # Feature utilities
â”‚   â”‚   â””â”€â”€ [other-features]/
â”‚   â”œâ”€â”€ layouts/                 # Admin layouts
â”‚   â””â”€â”€ theme/                   # Admin theming
â”‚   â”œâ”€â”€ AdminRoutes.tsx      # Admin routes aggregator
â””â”€â”€ .env                         # NEW: Environment types
```
## ğŸ”‘ MANDATORY EXPORT PATTERNS

### Feature Export Hub (index.ts):
```typescript
// âœ… REQUIRED: Every feature MUST export via index.ts
export { FeatureListPage, FeatureDetailPage, FeatureCreatePage } from './pages';
export { FeatureTable, FeatureForm, FeatureCard } from './components';
export { useFeatures, useFeature, useCreateFeature, useUpdateFeature } from './hooks';
export { featureApi } from './services';
export type { Feature, FeatureFormData, FeatureFilters } from './types';
export { default as FeatureRouter } from './router';
```

### Feature Router Pattern (router.tsx):
```tsx
// âœ… REQUIRED: Every feature MUST have dedicated router
import { Routes, Route } from 'react-router-dom';
import { ErrorBoundary } from 'shared/components';
import { ProtectedRoute } from 'app/router/ProtectedRoute.tsx';
import { FeatureListPage, FeatureDetailPage, FeatureCreatePage } from './pages';

export default function FeatureRouter() {
  return (
    <ErrorBoundary fallback={ErrorFallback}>
      <Routes>
        <Route path="/" element={<FeatureListPage />} />
        <Route 
          path="/create" 
          element={
            <ProtectedRoute requirePermission="feature:create">
              <FeatureCreatePage />
            </ProtectedRoute>
          } 
        />
        <Route path="/:id" element={<FeatureDetailPage />} />
        <Route 
          path="/:id/edit" 
          element={
            <ProtectedRoute requirePermission="feature:update">
              <FeatureEditPage />
            </ProtectedRoute>
          } 
        />
      </Routes>
    </ErrorBoundary>
  );
}
```
## ğŸ”§ API CLIENT CONFIGURATION

### Required API Setup (src/shared/lib/axiosInstance.ts):
```typescript
// âœ… MANDATORY: Centralized API client
import axios, { type InternalAxiosRequestConfig } from 'axios';
import { useAuthStore } from 'app/stores/authStore';

const api = axios.create({
baseURL: import.meta.env.VITE_API_BASE_URL,
headers: {
  'Content-Type': 'application/json',
},
});

// âœ… REQUIRED: Auth token interceptor
api.interceptors.request.use(
(config: InternalAxiosRequestConfig) => {
  const token = useAuthStore.getState().accessToken;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
},
(error) => Promise.reject(error)
);
```
```tsx
// âœ… REQUIRED: ALL pages MUST be wrapped in ErrorBoundary
import { ErrorBoundary } from 'shared/components';

export default function FeaturePage() {
  const { data, isLoading, error } = useFeatures();
  
  // âœ… Let ErrorBoundary catch errors
  if (isLoading) return <LoadingSpinner />;
  if (error) throw error;

  return (
    <ErrorBoundary fallback={ErrorFallback}>
      <div className="container mx-auto py-6">
        <h1 className="text-2xl font-bold mb-6">Feature Title</h1>
        {/* Page content */}
      </div>
    </ErrorBoundary>
  );
}
```
### API Hooks:
```typescript
// âœ… REQUIRED: Standardized React Query patterns
export const useFeatures = (params?: FeatureParams) => {
  return useQuery({
    queryKey: ['features', params],
    queryFn: () => featureApi.getAll(params),
    throwOnError: true, // Let ErrorBoundary catch
    retry: (failureCount, error) => {
      // Don't retry on 4xx errors
      if (error.response?.status >= 400 && error.response?.status < 500) {
        return false;
      }
      return failureCount < 3;
    },
    meta: { errorMessage: 'KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u' }
  });
};

export const useCreateFeature = () => {
  return useMutation({
    mutationFn: featureApi.create,
    onError: (error) => {
      toast.error(error.message || 'CÃ³ lá»—i xáº£y ra');
    },
    throwOnError: false // Handle locally in forms
  });
};
```
## ğŸš¨ ERROR HANDLING STRATEGY (Má»¥c Má»›i - LÃ m RÃµ)

*   **NguyÃªn táº¯c:** Xá»­ lÃ½ lá»—i má»™t cÃ¡ch nháº¥t quÃ¡n vÃ  cung cáº¥p pháº£n há»“i rÃµ rÃ ng cho ngÆ°á»i dÃ¹ng vÃ  developer.
*   **Error Boundaries:**
    *   âœ… **Báº®T BUá»˜C:** Bá»c táº¥t cáº£ cÃ¡c **trang (page components)** vÃ  **feature routers** báº±ng component `ErrorBoundary` (tá»« `shared/components/ErrorBoundary`).
    *   âœ… Cung cáº¥p `fallback` UI há»£p lÃ½ cho `ErrorBoundary` Ä‘á»ƒ trÃ¡nh mÃ n hÃ¬nh tráº¯ng.
*   **API Query Errors (`useQuery`, `useInfiniteQuery`):**
    *   âœ… **Báº®T BUá»˜C:** Sá»­ dá»¥ng `throwOnError: true` trong options cá»§a `useQuery`. Lá»—i sáº½ Ä‘Æ°á»£c lan truyá»n lÃªn vÃ  báº¯t bá»Ÿi `ErrorBoundary` gáº§n nháº¥t.
    *   âœ… `ErrorBoundary` sáº½ hiá»ƒn thá»‹ fallback UI (vÃ­ dá»¥: trang lá»—i chung, thÃ´ng bÃ¡o lá»—i táº¡i chá»—).
    *   âœ… Cáº¥u hÃ¬nh `retry` logic trong `QueryClient` hoáº·c tá»«ng query Ä‘á»ƒ tá»± Ä‘á»™ng thá»­ láº¡i cÃ¡c lá»—i máº¡ng hoáº·c server táº¡m thá»i (5xx). KhÃ´ng nÃªn retry lá»—i client (4xx).
    *   âœ… CÃ³ thá»ƒ cung cáº¥p `meta: { errorMessage: '...' }` trong `useQuery` Ä‘á»ƒ `QueryClient` hoáº·c `ErrorBoundary` cÃ³ thá»ƒ hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ¢n thiá»‡n hÆ¡n.
*   **API Mutation Errors (`useMutation`):**
    *   âœ… **KHUYáº¾N KHÃCH:** Sá»­ dá»¥ng `throwOnError: false` (máº·c Ä‘á»‹nh).
    *   âœ… Xá»­ lÃ½ lá»—i trá»±c tiáº¿p trong callback `onError` cá»§a `useMutation` hoáº·c trong logic gá»i `mutate`/`mutateAsync`.
    *   âœ… Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cá»¥ thá»ƒ cho ngÆ°á»i dÃ¹ng (vÃ­ dá»¥: sá»­ dá»¥ng `react-hot-toast` hoáº·c hiá»ƒn thá»‹ lá»—i trá»±c tiáº¿p trÃªn form).
    *   âœ… VÃ­ dá»¥: Cáº­p nháº­t state lá»—i cá»§a form, hiá»ƒn thá»‹ toast thÃ´ng bÃ¡o "LÆ°u tháº¥t báº¡i: [lÃ½ do]".
*   **Form Validation Errors:**
    *   âœ… **Báº®T BUá»˜C:** Sá»­ dá»¥ng `zod` vÃ  `zodResolver` (vá»›i `react-hook-form`) Ä‘á»ƒ validate dá»¯ liá»‡u form phÃ­a client.
    *   âœ… Hiá»ƒn thá»‹ lá»—i validation trá»±c tiáº¿p dÆ°á»›i cÃ¡c trÆ°á»ng input tÆ°Æ¡ng á»©ng.
    *   âœ… Xá»­ lÃ½ lá»—i submit chung (vÃ­ dá»¥: lá»—i máº¡ng khi submit, lá»—i tá»« API sau khi validate thÃ nh cÃ´ng phÃ­a client) nhÆ° trong vÃ­ dá»¥ `FeatureForm` cá»§a báº¡n (sá»­ dá»¥ng `try...catch` vÃ  state `submitError`).
*   **Unexpected Client-Side Errors:**
    *   CÃ¡c lá»—i JavaScript khÃ´ng mong muá»‘n khÃ¡c trong quÃ¡ trÃ¬nh render hoáº·c xá»­ lÃ½ logic UI sáº½ Ä‘Æ°á»£c báº¯t bá»Ÿi `ErrorBoundary`.
*   **Logging:**
    *   âœ… **KHUYáº¾N KHÃCH:** TÃ­ch há»£p dá»‹ch vá»¥ logging (nhÆ° Sentry) Ä‘á»ƒ ghi láº¡i táº¥t cáº£ cÃ¡c lá»—i Ä‘Æ°á»£c báº¯t bá»Ÿi `ErrorBoundary` vÃ  cÃ¡c lá»—i khÃ´ng mong muá»‘n khÃ¡c trong mÃ´i trÆ°á»ng production.

```tsx
// âœ… Page Component vá»›i ErrorBoundary 
import { ErrorBoundary } from 'shared/components';
import { ErrorFallback } from 'shared/components/ErrorFallback'; // Component hiá»ƒn thá»‹ lá»—i

export default function FeaturePage() {
  const { data, isLoading, error } = useFeatures(); // throwOnError: true

  // React Query sáº½ throw lá»—i náº¿u cÃ³, ErrorBoundary sáº½ báº¯t
  if (isLoading) return <LoadingSpinner />;
  // KhÃ´ng cáº§n check error á»Ÿ Ä‘Ã¢y náº¿u dÃ¹ng throwOnError: true

  return (
    <ErrorBoundary fallback={<ErrorFallback />}>
      {/* ... content ... */}
    </ErrorBoundary>
  );
}

// âœ… Mutation Handling 
export const useCreateFeature = () => {
  const queryClient = useQueryClient(); // Äá»ƒ invalidate cache
  return useMutation({
    mutationFn: featureApi.create,
    onSuccess: () => {
      toast.success('Táº¡o thÃ nh cÃ´ng!');
      queryClient.invalidateQueries({ queryKey: ['features'] });
    },
    onError: (error: ApiError) => { // Giáº£ sá»­ ApiError lÃ  type lá»—i cá»§a báº¡n
      // Xá»­ lÃ½ lá»—i cá»¥ thá»ƒ á»Ÿ Ä‘Ã¢y, khÃ´ng throw lÃªn ErrorBoundary
      toast.error(error.message || 'CÃ³ lá»—i xáº£y ra khi táº¡o.');
    },
    // throwOnError: false (máº·c Ä‘á»‹nh)
  });
};
```

## ğŸ“¦ IMPORT & ALIAS RULES

### Import Order:
```typescript
// âœ… REQUIRED ORDER:
import React from 'react';                    // 1. React
import { useQuery } from '@tanstack/react-query'; // 2. External libraries
import { Button } from 'shared/components';   // 3. Shared (alias)
import { useFeatures } from './hooks';        // 4. Relative (same feature)
```

### Alias Configuration:
- âœ… `shared/` â†’ `src/shared/`
- âœ… `public/` â†’ `src/public/`
- âœ… `admin/` â†’ `src/admin/`
- ğŸš« NO relative imports `../../../`

## ğŸ”„ STATE MANAGEMENT

*   **NguyÃªn táº¯c cá»‘t lÃµi:** PhÃ¢n tÃ¡ch rÃµ rÃ ng giá»¯a **Server State** vÃ  **Client/UI State**.
*   **Server State (API Cache):**
    *   âœ… **Báº®T BUá»˜C:** Sá»­ dá»¥ng **TanStack Query (React Query)** Ä‘á»ƒ quáº£n lÃ½ tráº¡ng thÃ¡i dá»¯ liá»‡u tá»« API (fetching, caching, synchronization, updating).
    *   âœ… Cáº¥u hÃ¬nh instance QueryClient táº­p trung táº¡i `src/shared/lib/react-query.ts`.
    *   âœ… Sá»­ dá»¥ng cÃ¡c hook nhÆ° `useQuery`, `useInfiniteQuery`, `useMutation` trong thÆ° má»¥c `hooks/` cá»§a tá»«ng feature.
    *   âœ… LuÃ´n cung cáº¥p `queryKey` há»£p lÃ½ vÃ  táº­n dá»¥ng caching.
    *   âœ… Sá»­ dá»¥ng `throwOnError: true` trong `useQuery` Ä‘á»ƒ lá»—i Ä‘Æ°á»£c báº¯t bá»Ÿi `ErrorBoundary` gáº§n nháº¥t (thÆ°á»ng lÃ  á»Ÿ cáº¥p Ä‘á»™ trang hoáº·c router).
    *   âœ… Xá»­ lÃ½ lá»—i mutation (`useMutation`) cá»¥c bá»™ (vÃ­ dá»¥: hiá»ƒn thá»‹ toast, cáº­p nháº­t state form) thay vÃ¬ `throwOnError`, trá»« khi cáº§n thiáº¿t.
*   **Client/UI State:**
    *   âœ… **Báº®T BUá»˜C:** Sá»­ dá»¥ng **Zustand** cho tráº¡ng thÃ¡i UI toÃ n cá»¥c (global UI state) hoáº·c tráº¡ng thÃ¡i phá»©c táº¡p cáº§n chia sáº» giá»¯a cÃ¡c component khÃ´ng liÃªn quan trá»±c tiáº¿p.
    *   âœ… Äáº·t global stores trong `src/app/stores/`.
    *   âœ… Feature-specific UI stores (náº¿u thá»±c sá»± cáº§n thiáº¿t vÃ  khÃ´ng thá»ƒ quáº£n lÃ½ báº±ng state component hoáº·c URL) cÃ³ thá»ƒ Ä‘áº·t trong `[feature]/stores/`.
    *   âœ… Sá»­ dá»¥ng middleware (nhÆ° `persist` cho `localStorage`) khi cáº§n thiáº¿t.
    *   âœ… Chá»‰ lÆ°u trá»¯ tráº¡ng thÃ¡i UI tá»‘i thiá»ƒu cáº§n thiáº¿t trong Zustand (vÃ­ dá»¥: tráº¡ng thÃ¡i modal, bá»™ lá»c UI táº¡m thá»i, lá»±a chá»n cá»§a ngÆ°á»i dÃ¹ng). **KHÃ”NG** lÆ°u trá»¯ dá»¯ liá»‡u server trong Zustand.
    *   âœ… Sá»­ dá»¥ng state cá»§a component React (`useState`, `useReducer`) cho tráº¡ng thÃ¡i cá»¥c bá»™, khÃ´ng cáº§n chia sáº».
    *   âœ… Sá»­ dá»¥ng URL Search Params (quáº£n lÃ½ qua React Router) cho tráº¡ng thÃ¡i cáº§n bookmark, chia sáº» qua URL (vÃ­ dá»¥: trang hiá»‡n táº¡i cá»§a pagination, bá»™ lá»c chÃ­nh).

```typescript
// âœ… Server state: React Query
export const useFeatures = (params?: FeatureParams) => {
  return useQuery({
    queryKey: ['features', params],
    queryFn: () => featureApi.getAll(params),
    throwOnError: true, // Äá»ƒ ErrorBoundary xá»­ lÃ½
  });
};

// âœ… Global UI state: Zustand
// src/app/stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
// ... (Giá»¯ nguyÃªn implementation cá»§a useAuthStore)

// âœ… Feature-specific UI state (VÃ­ dá»¥): Zustand
// src/public/features/some-feature/stores/uiStore.ts
interface FeatureUIState {
  isFilterPanelOpen: boolean;
  toggleFilterPanel: () => void;
}
export const useFeatureUIStore = create<FeatureUIState>((set) => ({
  isFilterPanelOpen: false,
  toggleFilterPanel: () => set((state) => ({ isFilterPanelOpen: !state.isFilterPanelOpen })),
}));
```
## ğŸš€ PERFORMANCE OPTIMIZATION

### Mandatory Lazy Loading Pattern:
```tsx
// âœ… REQUIRED: All feature routes MUST be lazy loaded
import React, { Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { LoadingSpinner } from 'shared/components/ui';
import { ErrorBoundary } from 'shared/components';

// âœ… Lazy load feature routes
const PublicRoutes = React.lazy(() => import('./PublicRoutes'));
const AdminRoutes = React.lazy(() => import('./AdminRoutes'));
const LoginPage = React.lazy(() => import('public/features/auth/pages/LoginPage'));

export function AppRouter() {
return (
  <BrowserRouter>
    <ErrorBoundary fallback={ErrorFallback}>
      <Suspense fallback={<LoadingSpinner />}>
        <Routes>
          <Route path="/login" element={<LoginPage />} />
          <Route path="/admin/*" element={<AdminRoutes />} />
          <Route path="/*" element={<PublicRoutes />} />
        </Routes>
      </Suspense>
    </ErrorBoundary>
  </BrowserRouter>
);
}
```

## ğŸ§ª TESTING REQUIREMENTS

### Testing Structure:
- âœ… Test files MUST be colocated with source files
- âœ… Use Vitest + React Testing Library
- âœ… File naming: `*.test.tsx` or `*.spec.tsx`

### Testing Rules:
```typescript
// âœ… MANDATORY: Component test example
// src/shared/components/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from './Button';

describe('Button', () => {
it('should handle click events', () => {
  const handleClick = vi.fn();
  render(<Button onClick={handleClick}>Click me</Button>);
  
  fireEvent.click(screen.getByText('Click me'));
  expect(handleClick).toHaveBeenCalledTimes(1);
});
});
```

### Coverage Requirements:
- âœ… `shared/components/`: Minimum 80% coverage
- âœ… Custom hooks: 100% coverage for business logic
- âœ… Critical pages (booking, payment): Integration tests required
- ğŸš« NO mocking child components - test user behavior

## ğŸŒ ENVIRONMENT VARIABLES

### Environment Configuration:
```typescript
// âœ… REQUIRED: src/env.d.ts
interface ImportMetaEnv {
readonly VITE_API_BASE_URL: string;
readonly VITE_APP_NAME: string;
readonly VITE_APP_VERSION: string;
readonly VITE_FIREBASE_API_KEY?: string;
readonly VITE_SENTRY_DSN?: string;
}

interface ImportMeta {
readonly env: ImportMetaEnv;
}
```

### Environment Rules:
- âœ… Client-side variables MUST start with `VITE_`
- âœ… All env vars MUST be typed in `env.d.ts`
- ğŸš« NO hardcoded URLs, keys, or secrets
- âœ… Use `import.meta.env.VITE_*` for access


## ğŸ¨ STYLING & CODE FORMATTING
*   **Dark Mode:**
    *   âœ… **Báº®T BUá»˜C:** Táº¥t cáº£ cÃ¡c component UI má»›i hoáº·c Ä‘Æ°á»£c chá»‰nh sá»­a trong `shared/components/` (bao gá»“m `ui/`, `forms/`, `layout/`, `data-table/`) **PHáº¢I** há»— trá»£ **Dark Mode**.
    *   âœ… Sá»­ dá»¥ng tiá»n tá»‘ `dark:` cá»§a Tailwind CSS cho cÃ¡c style Ã¡p dá»¥ng trong dark mode.
    *   âœ… Äáº£m báº£o Ä‘á»™ tÆ°Æ¡ng pháº£n (contrast) tá»‘t á»Ÿ cáº£ light vÃ  dark mode theo tiÃªu chuáº©n WCAG.
    *   âœ… Component `ThemeProvider` (trong `src/app/providers/`) chá»‹u trÃ¡ch nhiá»‡m chuyá»ƒn Ä‘á»•i theme.

---
### Automated Code Style:
```javascript
// âœ… REQUIRED: .eslintrc.cjs
module.exports = {
plugins: ['import'],
rules: {
  'import/order': [
    'error',
    {
      groups: ['builtin', 'external', 'internal', 'parent', 'sibling', 'index'],
      pathGroups: [
        {
          pattern: 'react',
          group: 'external',
          position: 'before',
        },
        {
          pattern: '{app,shared,public,admin}/**',
          group: 'internal',
        },
      ],
      pathGroupsExcludedImportTypes: ['react'],
      'newlines-between': 'always',
      alphabetize: {
        order: 'asc',
        caseInsensitive: true,
      },
    },
  ],
},
};
```

### Tailwind Class Ordering:
- âœ… Install `prettier-plugin-tailwindcss`
- âœ… Classes auto-sorted: layout â†’ spacing â†’ typography â†’ background â†’ border â†’ effects

## ğŸ” SECURITY PATTERNS

### Authentication Flow:
```typescript
// âœ… REQUIRED: Protected route implementation
export function ProtectedRoute({ 
children, 
requirePermission 
}: { 
children: ReactNode; 
requirePermission?: string;
}) {
const { user } = useAuthStore();

if (!user) {
  return <Navigate to="/login" replace />;
}

if (requirePermission && !user.permissions?.includes(requirePermission)) {
  return <Navigate to="/unauthorized" replace />;
}

return <>{children}</>;
}
```

## ğŸ“Š MONITORING & LOGGING

### Error Tracking:
```typescript
// âœ… RECOMMENDED: Sentry integration
import * as Sentry from '@sentry/react';

Sentry.init({
dsn: import.meta.env.VITE_SENTRY_DSN,
environment: import.meta.env.MODE,
integrations: [
  new Sentry.BrowserTracing(),
  new Sentry.Replay(),
],
});
```
## ğŸ“Š DATA TABLES (TanStack Table)

*   **Vá»‹ trÃ­:**
    *   âœ… **Báº®T BUá»˜C:** Component `DataTable` tÃ¡i sá»­ dá»¥ng vÃ  cÃ¡c thÃ nh pháº§n liÃªn quan (types, helpers) pháº£i Ä‘Æ°á»£c Ä‘áº·t trong `src/shared/components/data-table/`.
*   **Sá»­ dá»¥ng:**
    *   âœ… **Báº®T BUá»˜C:** Sá»­ dá»¥ng component `DataTable` tá»« `shared/components/data-table/` cho táº¥t cáº£ cÃ¡c báº£ng dá»¯ liá»‡u trong á»©ng dá»¥ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n.
    *   âœ… **Báº®T BUá»˜C:** Äá»‹nh nghÄ©a `ColumnDef<T>` trong file riÃªng cá»§a feature (vÃ­ dá»¥: `[feature]/components/FeatureTableColumns.tsx`) hoáº·c trá»±c tiáº¿p táº¡i nÆ¡i sá»­ dá»¥ng `DataTable`.
    *   âœ… **KHUYáº¾N KHÃCH:** Sá»­ dá»¥ng cÃ¡c hÃ m helper (nhÆ° `createActionColumn`, `createTableColumns`, `usePagination` tá»« `data-table-helpers.tsx`) Ä‘á»ƒ táº¡o cá»™t action vÃ  cáº¥u hÃ¬nh pagination má»™t cÃ¡ch nháº¥t quÃ¡n.
*   **State Management cho Báº£ng:**
    *   **Sorting & Filtering:**
        *   **Client-side:** Cho cÃ¡c báº£ng nhá» hoáº·c khÃ´ng yÃªu cáº§u server-side processing, cÃ³ thá»ƒ sá»­ dá»¥ng state ná»™i bá»™ cá»§a `useReactTable` (nhÆ° trong vÃ­ dá»¥ `data-table.tsx` cá»§a báº¡n vá»›i `globalFilter` vÃ  `sorting`).
        *   **Server-side:** Khi cáº§n thiáº¿t (dá»¯ liá»‡u lá»›n, yÃªu cáº§u hiá»‡u nÄƒng), state sorting vÃ  filtering pháº£i Ä‘Æ°á»£c quáº£n lÃ½ bÃªn ngoÃ i `DataTable` (thÆ°á»ng lÃ  trong hook React Query cá»§a feature). Truyá»n cÃ¡c giÃ¡ trá»‹ state nÃ y vÃ  cÃ¡c hÃ m callback Ä‘á»ƒ cáº­p nháº­t chÃºng vÃ o `DataTable` thÃ´ng qua props (cáº§n má»Ÿ rá»™ng `DataTableProps` náº¿u cáº§n). `DataTable` chá»‰ hiá»ƒn thá»‹ UI vÃ  trigger callback.
    *   **Pagination:**
        *   **Client-side:** Náº¿u toÃ n bá»™ dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c táº£i vá» client, cÃ³ thá»ƒ dÃ¹ng `getPaginationRowModel` vÃ  state ná»™i bá»™.
        *   **Server-side:** **Báº®T BUá»˜C** cho háº§u háº¿t cÃ¡c trÆ°á»ng há»£p. Quáº£n lÃ½ state pagination (trang hiá»‡n táº¡i, kÃ­ch thÆ°á»›c trang, tá»•ng sá»‘ báº£n ghi) bÃªn ngoÃ i `DataTable` (thÆ°á»ng trong hook React Query, láº¥y tá»« API response). Truyá»n state vÃ  callback `onPageChange` vÃ o prop `pagination` cá»§a `DataTable` (nhÆ° báº¡n Ä‘Ã£ lÃ m).
*   **Actions:**
    *   âœ… Sá»­ dá»¥ng hÃ m `createActionColumn` hoáº·c helper `createTableColumns` Ä‘á»ƒ táº¡o cá»™t hÃ nh Ä‘á»™ng (View, Edit, Delete, Custom) má»™t cÃ¡ch thá»‘ng nháº¥t.
    *   âœ… Logic xá»­ lÃ½ action (vÃ­ dá»¥: gá»i API delete, Ä‘iá»u hÆ°á»›ng Ä‘áº¿n trang edit) pháº£i náº±m trong cÃ¡c hÃ m `onClick` Ä‘Æ°á»£c truyá»n vÃ o tá»« feature component, khÃ´ng náº±m trong `DataTable`.
*   **Styling:**
    *   âœ… Sá»­ dá»¥ng Tailwind CSS vÃ  cÃ¡c component tá»« `shared/components/ui/` (hoáº·c shadcn/ui trá»±c tiáº¿p náº¿u khÃ´ng cáº§n tÃ¹y chá»‰nh nhiá»u) Ä‘á»ƒ style `DataTable`.
    *   âœ… **Báº®T BUá»˜C:** Äáº£m báº£o `DataTable` vÃ  cÃ¡c thÃ nh pháº§n con (header, cell, pagination, actions) hiá»ƒn thá»‹ Ä‘Ãºng vÃ  Ä‘áº¹p máº¯t á»Ÿ cáº£ **Light Mode** vÃ  **Dark Mode**.
*   **TÃ¡i sá»­ dá»¥ng vÃ  TÃ¹y chá»‰nh:**
    *   Component `DataTable` nÃªn Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng tá»‘i Ä‘a thÃ´ng qua props (`columns`, `data`, `pagination`, `loading`, `emptyState`, `searchable`, etc.).
    *   TrÃ¡nh thÃªm logic Ä‘áº·c thÃ¹ cá»§a feature vÃ o component `DataTable` chung. Náº¿u cáº§n tÃ¹y chá»‰nh phá»©c táº¡p cho má»™t feature cá»¥ thá»ƒ, hÃ£y xem xÃ©t táº¡o má»™t component wrapper riÃªng cho feature Ä‘Ã³.

---
## ğŸš« STRICTLY PROHIBITED

### Anti-patterns to Avoid:
- âŒ Components outside defined folder structure
- âŒ Direct imports between features (must use shared/)
- âŒ Business logic in components (use hooks/services)
- âŒ Hardcoded URLs, keys, or configuration
- âŒ Direct API calls in components
- âŒ Missing error boundaries on pages
- âŒ Untyped API responses
- âŒ Manual CSS in public pages
- âŒ Features without dedicated routers
- âŒ Missing test files for shared components
- âŒ Synchronous route imports (must lazy load)
- âŒ State mutations outside actions
- âŒ Console.log in production code

## âœ… DEVELOPMENT WORKFLOW

### Pre-commit Checklist:
1. âœ… All imports follow ordering rules
2. âœ… TypeScript errors resolved
3. âœ… Tests passing with coverage
4. âœ… No hardcoded values
5. âœ… Error boundaries in place
6. âœ… Lazy loading implemented
7. âœ… API calls use centralized client
8. âœ… Zustand stores for UI state only
9. âœ… React Query for server state
10. âœ… Environment variables typed

### Code Review Focus:
- Performance: Check for unnecessary re-renders
- Security: Validate auth flows and data exposure
- Accessibility: ARIA labels and keyboard navigation
- Error Handling: Graceful degradation
- Type Safety: No `any` types without justification